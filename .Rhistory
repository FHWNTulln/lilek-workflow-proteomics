###############################
#
#define settings
#
###############################
GET_SAMPLE_NAMES <- FALSE # if set to FALSE define it in the next line
sample_names_user <- sample(LETTERS,1)
unique <- 2  #how many peptides should be at least necessary to identify a protein
RAZOR <- TRUE #TRUE | FALSE
UNIQUE <- TRUE #TRUE | FALSE
LFQ <- TRUE #TRUE | FALSE
path = "N:/1_A_Bachelor_Master_Intern/00_M_2022/David/Data/3_20220406_TR/20220406_TR_QC_MBR_rerun_4masterthesis/"
#path = "C:/Users/lilek/Desktop/20220406_TR_QC_MBR_rerun_4masterthesis/"
###############################
#
#define settings
#
###############################
GET_SAMPLE_NAMES <- FALSE # if set to FALSE define it in the next line
sample_names_user <- sample(LETTERS,1)
unique <- 2  #how many peptides should be at least necessary to identify a protein
RAZOR <- TRUE #TRUE | FALSE
UNIQUE <- TRUE #TRUE | FALSE
LFQ <- TRUE #TRUE | FALSE
path = "N:/1_A_Bachelor_Master_Intern/00_M_2022/David/Data/3_20220406_TR/20220406_TR_QC_MBR_rerun_4masterthesis/"
#path = "C:/Users/lilek/Desktop/20220406_TR_QC_MBR_rerun_4masterthesis/"
start_time = format(Sys.time(), '%X')
knitr::opts_chunk$set(echo = TRUE)
#load libraries
library(tidyverse)
library(dplyr)
library(gplots)
library(reshape2)
library(pheatmap)
#load functions
filtering <- function(data_raw){
data_raw %>% filter(
Potential.contaminant == "",
Reverse == "",
Only.identified.by.site == "")
}
CV <- function(x){
(sd(x)/mean(x))*100
}
##########read in all data with pattern .txt
# get file list
file.list <- list.files(path = path, pattern='*.txt')
# create file path
file.path <- paste(path,file.list,sep = "")
# read in files - for each file one variable is created - results are stored in a list
res_raw <- lapply(file.path, read.delim)
names(res_raw) <- file.list
if (GET_SAMPLE_NAMES == TRUE){
#get sample names
tmp <- colnames(res_raw[[1]])
tmp <- tmp[grep("Razor...unique.peptides.",tmp)]
tmp <- sub(".*Razor...unique.peptides.", "",tmp)
sample_names_raw <- tmp
rm(tmp)
#create sample names
sample_names_razor <- paste("Razor...unique.peptides.",sample_names_raw, sep="")
sample_names_unique <- paste("Unique.peptides.",sample_names_raw, sep="")
sample_names_lfq <- paste("LFQ.intensity.",sample_names_raw, sep="")
} else {
for (i in 1:length(file.list)){
#rename columns
res_raw[[i]] <- res_raw[[i]] %>%
rename_with(~ paste("Razor_", sample_names_user, sep = ""), starts_with("Razor...unique.peptides.")) %>%
rename_with(~ paste("Unique_", sample_names_user, sep = ""), starts_with("Unique.peptides.")) %>%
rename_with(~ paste("LFQ_", sample_names_user, sep = ""), starts_with("LFQ.intensity."))
#get column names
sample_names_razor <- colnames(res_raw[[i]][grep("Razor_", colnames(res_raw[[i]]))])
sample_names_unique <- colnames(res_raw[[i]][grep("Unique_", colnames(res_raw[[i]]))])
sample_names_lfq <- colnames(res_raw[[i]][grep("LFQ_", colnames(res_raw[[i]]))])
}
}
###############################
#
#define settings
#
###############################
GET_SAMPLE_NAMES <- TRUE # if set to FALSE define it in the next line
#sample_names_user <- sample(LETTERS,1)
unique <- 2  #how many peptides should be at least necessary to identify a protein
RAZOR <- TRUE #TRUE | FALSE
UNIQUE <- TRUE #TRUE | FALSE
LFQ <- TRUE #TRUE | FALSE
path = "N:/1_A_Bachelor_Master_Intern/00_M_2022/David/Data/3_20220406_TR/20220406_TR_QC_MBR_rerun_4masterthesis/"
#path = "C:/Users/lilek/Desktop/20220406_TR_QC_MBR_rerun_4masterthesis/"
start_time = format(Sys.time(), '%X')
knitr::opts_chunk$set(echo = TRUE)
#load libraries
library(tidyverse)
library(dplyr)
library(gplots)
library(reshape2)
library(pheatmap)
#load functions
filtering <- function(data_raw){
data_raw %>% filter(
Potential.contaminant == "",
Reverse == "",
Only.identified.by.site == "")
}
CV <- function(x){
(sd(x)/mean(x))*100
}
##########read in all data with pattern .txt
# get file list
file.list <- list.files(path = path, pattern='*.txt')
# create file path
file.path <- paste(path,file.list,sep = "")
# read in files - for each file one variable is created - results are stored in a list
res_raw <- lapply(file.path, read.delim)
names(res_raw) <- file.list
if (GET_SAMPLE_NAMES == TRUE){
#get sample names
tmp <- colnames(res_raw[[1]])
tmp <- tmp[grep("Razor...unique.peptides.",tmp)]
tmp <- sub(".*Razor...unique.peptides.", "",tmp)
sample_names_raw <- tmp
rm(tmp)
#create sample names
sample_names_razor <- paste("Razor...unique.peptides.",sample_names_raw, sep="")
sample_names_unique <- paste("Unique.peptides.",sample_names_raw, sep="")
sample_names_lfq <- paste("LFQ.intensity.",sample_names_raw, sep="")
} else {
for (i in 1:length(file.list)){
#rename columns
res_raw[[i]] <- res_raw[[i]] %>%
rename_with(~ paste("Razor_", sample_names_user, sep = ""), starts_with("Razor...unique.peptides.")) %>%
rename_with(~ paste("Unique_", sample_names_user, sep = ""), starts_with("Unique.peptides.")) %>%
rename_with(~ paste("LFQ_", sample_names_user, sep = ""), starts_with("LFQ.intensity."))
#get column names
sample_names_razor <- colnames(res_raw[[i]][grep("Razor_", colnames(res_raw[[i]]))])
sample_names_unique <- colnames(res_raw[[i]][grep("Unique_", colnames(res_raw[[i]]))])
sample_names_lfq <- colnames(res_raw[[i]][grep("LFQ_", colnames(res_raw[[i]]))])
}
}
#another option would be
#uniq <- data %>% select(starts_with("Unique.peptides."))
#create data frame for razor
results_2gether_razor <- data.frame(matrix(ncol = length(sample_names_razor), nrow = length(file.list)))
row.names(results_2gether_razor) <- file.list
colnames(results_2gether_razor) <- sample_names_razor
#create data frame for unique
results_2gether_unique <- data.frame(matrix(ncol = length(sample_names_unique), nrow = length(file.list)))
row.names(results_2gether_unique) <- file.list
colnames(results_2gether_unique) <- sample_names_unique
#create data frame for lfq
results_2gether_lfq <- data.frame(matrix(ncol = length(sample_names_lfq), nrow = length(file.list)))
row.names(results_2gether_lfq) <- file.list
colnames(results_2gether_lfq) <- sample_names_lfq
#results lists
results_razor <- list()
results_unique <- list()
results_lfq <- list()
if (RAZOR == TRUE) {
cat("\n")
cat("##","Razor","\n")
cat("\n")
for (x in file.list){
cat("\n")
cat("###",substring(x, 1, nchar(x)-4),"\n")
data_raw <- as.data.frame(res_raw[[x]])
data <- filtering(data_raw)
results <- data.frame(matrix(ncol = length(sample_names_razor), nrow = nrow(data)))
colnames(results) <- sample_names_razor
i <- 0
for (i in 1:length(sample_names_razor)){
name <- sample_names_razor[i]
tmp <- (data[name] >= unique)
results[i] <- tmp
cat(name,"<br/>",sum(tmp, na.rm = TRUE),"<br/>")
}
results_razor[[x]] <- results
#assign(paste("results_razor",x,sep="_"),results) #create individual variable names
results_2gether_razor[x,] <- sapply(results,function(x)sum(x, na.rm = TRUE))
cat("\n")
}
}
if (UNIQUE == TRUE) {
cat("\n")
cat("##","Unique","\n")
cat("\n")
for (x in file.list){
cat("\n")
cat("###",substring(x, 1, nchar(x)-4),"\n")
data_raw <- as.data.frame(res_raw[[x]])
data <- filtering(data_raw)
results <- data.frame(matrix(ncol = length(sample_names_unique), nrow = nrow(data)))
colnames(results) <- sample_names_unique
i <- 0
for (i in 1:length(sample_names_unique)){
name <- sample_names_unique[i]
tmp <- (data[name] >= unique)
results[i] <- tmp
cat(name,"<br/>",sum(tmp, na.rm = TRUE),"<br/>")
}
results_unique[[x]] <- results
#assign(paste("results_razor",x,sep="_"),results) #create individual variable names
results_2gether_unique[x,] <- sapply(results,function(x)sum(x, na.rm = TRUE))
cat("\n")
}
}
if (LFQ == TRUE) {
cat("\n")
cat("##","LFQ","\n")
cat("\n")
for (x in file.list){
cat("\n")
cat("###",substring(x, 1, nchar(x)-4),"\n")
data_raw <- as.data.frame(res_raw[[x]])
data <- filtering(data_raw)
results <- data.frame(matrix(ncol = length(sample_names_lfq), nrow = nrow(data)))
colnames(results) <- sample_names_lfq
i <- 0
for (i in 1:length(sample_names_lfq)){
name <- sample_names_lfq[i]
tmp <- log2(data[name])
tmp[tmp == -Inf] <- NA
results[i] <- tmp
cat(name,"<br/>",sum(!is.na(tmp)),"<br/>")
}
results_lfq[[x]] <- results
#assign(paste("results_lfq",x,sep="_"),results) #create individual variable names
#create heatmaps
paletteLength <- 50
myColor <- colorRampPalette(c("navy", "white",  "firebrick3"))(paletteLength)
lfq4pheatmap <- results
if (ncol(lfq4pheatmap) < 2){
cat("\n")
cat("##"," No heatmap possible. Too less columns in the result table.","\n")
} else {
lfq4pheatmap[is.na(lfq4pheatmap)] <- 0
pheatmap(lfq4pheatmap,
color = myColor,
treeheight_row = 10,
angle_col ="45",
treeheight_col = 10,
legend = TRUE,
labels_row = rep("",nrow(lfq4pheatmap)))
}
results_2gether_lfq[x,] <- sapply(results,function(x)sum(!is.na(x)))
cat("\n")
}
}
#add number in column 4 for selection
results_2gether_razor$number <- c(1:length(file.list))
results_2gether_unique$number <- c(1:length(file.list))
results_2gether_lfq$number <- c(1:length(file.list))
end_time = format(Sys.time(), '%X')
print(paste("Time used for analysis:", round(as.difftime(end_time, units = "mins")-as.difftime(start_time, units = "mins"),digits=2),"minutes"))
if (RAZOR == TRUE){
results_2gether_razor
}
if (UNIQUE == TRUE){
results_2gether_unique
}
if (LFQ == TRUE){
results_2gether_lfq
}
View(res_raw)
View(res_raw)
View(results_razor)
view(results_razor[["results_run1_mqpar_20220406_TR_QC_MBR_rerun_4masterthesis_combined_txt_proteinGroups.txt"]])
view(results_razor[["results_run1_mqpar_20220406_TR_QC_MBR_rerun_4masterthesis_combined_txt_proteinGroups.txt"]])
View(results_unique)
View(results_2gether_unique)
?sapply
sapply(results,function(x)sum(x, na.rm = TRUE))
results
View(results_2gether_lfq)
results_2gether_lfq[1,]
